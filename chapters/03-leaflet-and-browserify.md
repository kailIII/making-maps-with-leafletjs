# Getting started with Leaflet.js using node.js, npm, and browserify

[Leaflet.js](http://leafletjs.com/) is an awesome, easy to learn mapping library. Here we’ll go through some introductory examples so you can get started using it in your projects.

Hey, if leaflet is a mapping library for browsers, what’s it doing on npm?

[Client-side code can be distributed through npm](http://maxogden.com/node-packaged-modules.html), and combined with a tool like [browserify](https://github.com/substack/node-browserify), which bundles node modules for the browser, it works pretty great.

Make sure you have node installed. I recommend using a tool called `nvm` for installing node.js if you're using mac or linux.

**nvm:** 

[github.com/creationix/nvm](https://github.com/creationix/nvm).

You can also install node.js by downloading an installer from the nodejs.org downloads page: 

[nodejs.org/downloads](http://nodejs.org/downloads).

## Installation and setting up
First, create and navigate to a new project directory and create these files:


```
mkdir leaflet-example
cd leaflet example
touch index.html app.js style.css

```

Now run `npm init` to create a package.json file.

You should get something like this after you answer the questions:


```
{
  "name": "leaflet-basics",
  "version": "0.0.0",
  "description": "introduction to using leaflet with browserify",
  "main": "app.js",
  "scripts": {
    "start": "beefy app.js:bundle.js --live",
    "bundle": "browserify app.js -o bundle.js"
  },
  "author": "",
  "license": "MIT",
  "dependencies": {
  },
  "devDependencies": {
  }
}
```

### Now install leaflet using `npm`
We'll use the `--save` argument so that leaflet.js is saved as a dependency in package.json


```
npm install --save leaflet

```

### html and css
Create an html file that looks like this:


```
<!doctype html>
<html>
<head>

<title>leaflet example</title>
<meta charset="utf-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="node_modules/leaflet/dist/leaflet.css">
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="map"></div>

<script src="bundle.js"></script>
</body>
</html>

```

Note that for the stylesheets we’re providing the path directly to the leaflet package in the node_modules folder:


```
node_modules/leaflet/dist/leaflet.css

```

Our script tag points to `bundle.js`, which will be generated by a tool called [beefy](https://github.com/chrisdickinson/beefy), which creates a development server with live reloading of browserify bundles.

Make sure the `#map` div has a height, otherwise the map won’t show up.

Add this to your the styles.css file:


```
#map {
  height: 300px;
}

```

### require leaflet
Now, in the app.js file, require the leaflet module like this:


```
var L = require('leaflet');

```

You could probably use any variable name here, but `L` is a common variable name for leaflet. You’ll see it in the leaflet [docs](http://leafletjs.com/reference.html) and [tutorials](http://leafletjs.com/examples.html).

### fix image path
Because we’re using browserify, we need to tell leaflet the specific location of the images folder that it needs to render the page:


```
L.Icon.Default.imagePath = 'node_modules/leaflet/dist/images/';

```

Now we can create a map! 

You can use the `L.map()` method to create the map:


```
var map = L.map('map');
map.setView([47.63, -122.32], 11);

```

The `map.setView()` method centers the map at a latitude/longitude, then sets the zoom level. In the above example the lat/long centers the map on Seattle, WA, and the zoom level is at 11.

Finally, we need to tell the map to use a specific tileset:


```
var attribution = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://cloudmade.com">CloudMade</a>';

var tiles = 'http://{s}.tile.cloudmade.com/!!! YOUR API KEY !!!/997/256/{z}/{x}/{y}.png';

L.tileLayer(tiles, {
  maxZoom: 18,
  attribution: attribution
}).addTo(map);

```

It’s important to properly attribute tile image and data sources, so we’re setting the `attribution` variable to a string crediting OpenStreetMap and CloudMade.

Next the `tiles` variable is set to a url for a popular cloudmade tileset. Note that we’re using the api key that Leaflet uses in tutorials. For production code you should [create an account on cloudmade.com](http://account.cloudmade.com/), and create an api key for your app.

Then you can replace the `!!! YOUR API KEY !!!` portion of the url seen below with your api key:


```
var tiles = 'http://{s}.tile.cloudmade.com/!!! YOUR API KEY !!!/997/256/{z}/{x}/{y}.png';

```

Currently, your app.js file should look like this:


```
// require leaflet.js
var L = require('leaflet');

// specify the path to the leaflet images folder
L.Icon.Default.imagePath = 'node_modules/leaflet/dist/images/';

// initialize the map
var map = L.map('map', {
  scrollWheelZoom: false
});

// set the position and zoom level of the map
map.setView([47.63, -122.32], 11);

// set an attribution string
var attribution = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://cloudmade.com">CloudMade</a>';

// set the tiles the map will use
var tiles = 'http://{s}.tile.cloudmade.com/!!! YOUR API KEY !!!/997/256/{z}/{x}/{y}.png';

// create a tileLayer with the tiles, attribution
var layer = L.tileLayer(tiles, {
  maxZoom: 18,
  attribution: attribution
});

// add the tile layer to the map
layer.addTo(map);

```

## Serving the development site using browserify & beefy

Now that we've got our basic components together, let's use browserify and beefy so you can serve the site on your computer.

First, install beefy and browserify. Here we'll use the `--save-dev` argument so that these modules get saved in our package.json file as development dependencies.


```
npm install --save-dev beefy browserify

```

Now that those modules are installed, we'll use the `beefy` command to run a development version of the site:


```
beefy app.js:bundle.js --live

```

This command takes our node-style code in app.js, and bundles it using browserify to serve the bundle.js file. The `--live` argument enables live reloading of the page, so every time you save a file, the browser will reload.

We can make our lives simpler and not have to remember/type that command all the time by using npm scripts.

In your package.json file, and change the scripts property to look like this:


```
"scripts": {
  "start": "beefy app.js:bundle.js --live"
},

```

Now, we can run a much simpler command to run the site:


```
npm start

```

Run that and you'll be able to go to http://localhost:9966 to see your site.

Note that running beefy doesn't create a bundle.js file in your file system, it just serves one through the development server.

To create a bundle.js file that you can use to deploy on GitHub Pages or wherever you host your site, you'll use the `browserify` command.

This will generate a bundle.js file:


```
browserify app.js -o bundle.js

```

We can use npm scripts again to simplify this:


```
"scripts": {
  "start": "beefy app.js:bundle.js --live",
  "bundle": "browserify app.js -o bundle.js"
},

```

Now, the `start` command is one of the few that npm directly supports. We can create commands with arbitrary names like `bundle`, but to use it, we prepend it with the `run` command, so it'll look like this:


```
npm run bundle

```

Run the above command and that will create the bundle.js file you can use when deploying your site to GitHub Pages or to another server.
